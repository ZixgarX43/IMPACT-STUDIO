<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>หมวดหมู่สินค้า - Capybara Store</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <a href="index.html" class="logo">Capybara <span class="dot">STORE</span></a>
                <ul class="nav-menu">
                    <li><a href="index.html">หน้าหลัก</a></li>
                    <li><a href="index.html#categories">หมวดหมู่</a></li>
                    <li><a href="index.html#products">สินค้า</a></li>
                    <li><a href="topup.html">เติมเงิน</a></li>
                </ul>
                <div class="nav-actions">
                    <span class="user-info">
                        สวัสดี, <span id="username">ผู้ใช้</span> | ยอดเงิน: ฿<span id="balance">0.00</span>
                    </span>
                    <button class="btn btn-logout" id="logoutBtn">ออกจากระบบ</button>
                </div>
                <div class="mobile-toggle">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
        </div>
    </nav>

    <!-- Category Header -->
    <section class="category-header">
        <div class="container">
            <button class="btn btn-back" onclick="window.location.href='index.html'">
                <i class="fas fa-arrow-left"></i> กลับหน้าหลัก
            </button>
            <h1 id="categoryTitle">หมวดหมู่สินค้า</h1>
            <p id="categoryDescription">เลือกดูสินค้าในหมวดหมู่ที่คุณสนใจ</p>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products">
        <div class="container">
            <div class="product-grid" id="categoryProductGrid">
                <!-- Products will be loaded by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 Capybara Store. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Load category products
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is logged in
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }

            // Update navbar with user info
            document.getElementById('username').textContent = currentUser.username;
            document.getElementById('balance').textContent = (currentUser.points || 0).toFixed(2);

            // Setup logout button
            document.getElementById('logoutBtn').addEventListener('click', () => {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            });

            // Get category from URL
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');

            if (!category) {
                window.location.href = 'index.html';
                return;
            }

            // Update category title
            document.getElementById('categoryTitle').textContent = `หมวดหมู่: ${category}`;

            // Load products
            loadCategoryProducts(category);
        });

        function loadCategoryProducts(categoryName) {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const filteredProducts = products.filter(p => p.category === categoryName);
            const grid = document.getElementById('categoryProductGrid');

            if (filteredProducts.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 80px 20px;">
                        <i class="fas fa-box-open" style="font-size: 5rem; color: #ccc; margin-bottom: 30px; display: block;"></i>
                        <h2 style="color: #666; margin-bottom: 15px;">ยังไม่มีสินค้าในหมวดหมู่นี้</h2>
                        <p style="color: #999; margin-bottom: 30px;">กรุณาเลือกหมวดหมู่อื่น หรือกลับไปหน้าหลัก</p>
                        <button class="btn btn-primary" onclick="window.location.href='index.html'">
                            <i class="fas fa-home"></i> กลับหน้าหลัก
                        </button>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredProducts.map(p => `
                <div class="product-card">
                    <div class="product-image">
                        ${p.image && p.image.startsWith('data:') ?
                    `<img src="${p.image}" style="width:100%; height:100%; object-fit:cover;">` :
                    `<div class="placeholder-img">${p.image || 'IMPACT'}</div>`
                }
                        ${p.badge ? `<span class="badge">${p.badge}</span>` : ''}
                    </div>
                    <div class="product-info">
                        <h3>${p.name}</h3>
                        <p class="desc">${p.desc}</p>
                        <div class="price-row">
                            <span class="price">฿${p.price}.00</span>
                            ${p.oldPrice ? `<span class="old-price">฿${p.oldPrice}.00</span>` : ''}
                        </div>
                        <button class="btn btn-cart" onclick="window.location.href='product.html?id=${p.id}'">
                            <i class="fas fa-search"></i> ดูรายละเอียด
                        </button>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>

</html>